/*!
 * FilePondPluginFileEncode 2.1.5
 * Licensed under MIT, https://opensource.org/licenses/MIT/
 * Please visit https://pqina.nl/filepond/ for details.
 */

/* eslint-disable */

!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e=e||self).FilePondPluginFileEncode=n()}(this,function(){"use strict";var e=function(){self.onmessage=function(n){e(n.data.message,function(e){self.postMessage({id:n.data.id,message:e})})};var e=function(e,n){var t=e.file,a=new FileReader;a.onloadend=function(){n(a.result.replace("data:","").replace(/^.+,/,""))},a.readAsDataURL(t)}},n=function(n){var t=n.addFilter,a=n.utils,i=a.Type,o=a.createWorker,d=a.createRoute,r=a.isFile,f=function(n){var t=n.name,a=n.file;return new Promise(function(n){var i=o(e);i.post({file:a},function(e){n({name:t,data:e}),i.terminate()})})},u=[];return t("DID_CREATE_ITEM",function(e,n){(0,n.query)("GET_ALLOW_FILE_ENCODE")&&(e.extend("getFileEncodeBase64String",function(){return u[e.id].data}),e.extend("getFileEncodeDataURL",function(){return"data:".concat(e.fileType,";base64,").concat(u[e.id].data)}))}),t("SHOULD_PREPARE_OUTPUT",function(e,n){var t=n.query;return new Promise(function(e){e(t("GET_ALLOW_FILE_ENCODE"))})}),t("COMPLETE_PREPARE_OUTPUT",function(e,n){var t=n.item,a=n.query;return new Promise(function(n){if(!a("GET_ALLOW_FILE_ENCODE")||!r(e)&&!Array.isArray(e))return n(e);u[t.id]={metadata:t.getMetadata(),data:null},Promise.all((e instanceof Blob?[{name:null,file:e}]:e).map(f)).then(function(a){u[t.id].data=e instanceof Blob?a[0].data:a,n(e)})})}),t("CREATE_VIEW",function(e){var n=e.is,t=e.view,a=e.query;n("file-wrapper")&&a("GET_ALLOW_FILE_ENCODE")&&t.registerWriter(d({DID_PREPARE_OUTPUT:function(e){var n=e.root,t=e.action;if(!a("IS_ASYNC")){var i=a("GET_ITEM",t.id);if(i){var o=u[i.id],d=o.metadata,r=o.data,f=JSON.stringify({id:i.id,name:i.file.name,type:i.file.type,size:i.file.size,metadata:d,data:r});n.ref.data?n.ref.data.value=f:n.dispatch("DID_DEFINE_VALUE",{id:i.id,value:f})}}},DID_REMOVE_ITEM:function(e){var n=e.action,t=a("GET_ITEM",n.id);t&&delete u[t.id]}}))}),{options:{allowFileEncode:[!0,i.BOOLEAN]}}};return"undefined"!=typeof window&&void 0!==window.document&&document.dispatchEvent(new CustomEvent("FilePond:pluginloaded",{detail:n})),n});
